/*!
 * JavaScript v2 v1.0.1
 * https://github.com/v2kit/v2
 *
 * @author hyly
 * @date 2018-08-01
 * @descript a valuable technology object.
 */
(function(n,t){function i(i){var r={};return{ctor:function(){this.rows=[];this.data={};this.submitEnter=!0;this.buttons=[]},init:function(){this.base.init();this.$=n(this.element)},render:function(n){this.base.render();n.inline&&this.addClass("form-inline");n.horizontal&&this.addClass("form-horizontal")},wait:function(n){this.__wait_==null&&(this.__wait_=this.constructor("wait",{sm:!0,fade:!0,context:this.element}));this.__wait_.toggle(n)},ajax:function(){var r={url:null,type:"GET",params:{}};this.invoke("ajax-ready",r)!==!1&&(this.wait(!0),n.ajax(r.url,{type:r.type,dataType:"json",data:r.params,success:function(n){i.invoke("ajax-success",n)!==!1&&(n.status?(i.invoke("ajax-load",n),i.sleep(!1)&&i.load()):t.validate("<strong>错误&ensp;:<\/strong>&ensp;&ensp;"+n.message+"","danger"));i.wait(!1)},error:function(n){i.invoke("ajax-error",n.status,n);i.wait(!1)}}))},ajaxLoad:function(n){this.data=n.data},load:function(){this.val(this.data)},val:function(n){if(arguments.length>0)return t.each(n,function(n,i){var u=r[i];return t.isArray(u)?t.each(u,function(t){t.val(n)}):u.val(n)});var u,i={};return t.each(r,function(n,r){if(n.group){var f=n.join,e=t.isFunction(f);return t.each(n.group,function(n){(u=n.val())&&(i[r]=e?f.call(n,i[r],u):i[r]?i[r]+","+u:u)})}(u=n.val())&&(i[r]=u)}),i},isValid:function(){return t.every(r,function(n){return n.tag==="input"||n.tag==="input-search"||n.tag==="inputSearch"?n.isValid()?!0:(n.validityError&&n.validityError.Massage(),n.focus(),!1):!0})},submit:function(){if(this.isValid()===!1)return!1;var r={url:null,type:"POST",params:this.val()};if(this.invoke("submit-ready",r)===!1)return!1;this.wait(!0);n.ajax(r.url,{type:r.type,dataType:"json",data:r.type.toUpperCase()==="GET"?r.params:JSON.stringify(r.params),contentType:"application/json;charset=UTF-8",success:function(n){i.invoke("submit-success",n)!==!1&&(n.status?i.invoke("submit-load",n):t.validate("<strong>错误&ensp;:<\/strong>&ensp;&ensp;"+n.message+"","danger"));i.wait(!1)},error:function(n){i.invoke("submit-error",n.status,n);i.wait(!1)}})},reset:function(){this.val(this.data)},resolve:function(){var n,u,f,e='<div class="form-group"><label for="form-{field}">{title}：<\/label><\/div>';t.each(this.rows=this.rows||[],function(o){i.$.append(o.type==="checkbox"||o.type==="radio"?t.format('<div class="form-group"><label>{0}：<\/label><\/div>',o.title):t.replace(e,o));u=n=n?n.next():i.$.children().eq(-1);o.options=t.extend(o.options,{id:"form-"+o.field,name:o.field,title:o.title,context:u});t.improve(o.options,{type:o.type});var h=function(n){return f&&(f.nextControl=n,n.previousControl=f),f=n},s=o.type==="search"?"inputSearch":o.type==="select"?"select":o.type==="checkbox"||o.type==="radio"?"check":"input";return s==="check"?r[o.field]=o.group?{join:o.join||",",group:t.map(o.group,function(n){return h(t(s,t.improve(!0,n,o.options)))})}:h(t(s,o.options)):o.group?t.each(o.group,function(n){t.isString(n)?u.append(n):r[n.field||o.field]=h(t(s,t.improve(!0,{id:"form-"+n.field,name:n.field},n,o.options)))}):r[o.field]=h(t(s,o.options))});this.$.append('<div class="form-group"><\/div>');u=n?n.next():this.$.children().eq(-1);t.each(t.makeArray(this.buttons),function(n){var r,f;return n.type==="submit"&&(r=n.click,n.click=i.proxy(i,r?function(){r.apply(this,arguments)!==!1&&i.submit()}:i.submit)),n.type==="reset"&&(f=n.click,n.click=i.proxy(i,f?function(){f.apply(this,arguments)!==!1&&i.reset()}:i.reset)),t("button",t.extend(n,{context:u}))});this.val(this.data)},commit:function(){this.$.on("keyup",function(n){var t=n.keyCode||n.which;(t===13||t===108)&&i.submitEnter&&i.submit()})}}}t.register("form",i)})(jQuery,v2Kit);