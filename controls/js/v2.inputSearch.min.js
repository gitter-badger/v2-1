/*!
 * JavaScript v2 v1.0.1
 * https://github.com/v2kit/v2
 *
 * @author hyly
 * @date 2018-08-01
 * @descript a valuable technology object.
 */
(function(n,t){function i(i){return{ctor:function(){this.timely=!1;this.data=[];this.showButton=!0;this.pageIndex=1;this.pageSize=10;this.pageTotal=0},init:function(){this.base.init();this.$dropdown=this.$.prepend('<ul class="input-dropdown dropdown-menu"><\/ul>').children().eq(0)},render:function(n){if(this.showButton){var i={attributes:{"data-submit":"ajax"},text:'<i class="glyphicons glyphicons-search"><\/i>'};n.buttonsNext=n.buttonsNext?t.makeArray(i,t.makeArray(n.buttonsNext)):i}this.base.render()},ajax:function(){var t={url:null,type:"GET",params:{keywords:this.value,page:this.pageIndex,size:this.pageSize}};this.invoke("ajax-ready",t)!==!1&&n.ajax(t.url,{type:t.type,dataType:"json",data:t.params,success:function(n){i.invoke("ajax-success",n)!==!1&&n.status&&(i.invoke("ajax-load",n),i.sleep(!1)&&i.load())},error:function(n){i.invoke("ajax-error",n.status,n)}})},ajaxLoad:function(n){this.data=n.data;this.pageTotal=n.total},load:function(){this.data&&this.data.length!==0?(this.$dropdown.empty().append(t.expression('{for(item in data) {"<li data-key="{item.id}"><a href="javascript:void(0)">{item.name}<\/a><\/li>"}^}',this.data)),this.timely&&this.$dropdown.children().eq(0).addClass("active")):this.$dropdown.empty().append('<li><a href="#">没有找到匹配的记录<\/a><\/li>');this.$dropdown.addClass("show")},val:function(n,t){if(n==null)return this.key||"";this.key=n;this.base.val(t==null?n:t)},keyboardEnter:function(){var n;this.$dropdown.hasClass("show")&&(n=this.$dropdown.find(".active")).length>0?(this.val(n.attr("data-key"),n.text()),this.$dropdown.removeClass("show")):(this.$dropdown.removeClass("show").empty(),this.ajax())},valueChange:function(){this.key="";this.timely&&(this.$dropdown.removeClass("show").empty(),this.ajax())},commit:function(){var i=this;this.base.commit();this.$.on("click",'[data-submit="ajax"]',function(){i.isValid()&&(i.$dropdown.empty(),i.ajax())});this.$input.on("click",function(){i.data&&i.data.length&&i.$dropdown.addClass("show")});this.$.on("keydown",function(n){var r=n.keyCode||n.which,u,t;r===27&&i.$dropdown.removeClass("show");i.data&&i.data.length&&(r===38||r===40)&&(u=i.$dropdown.children(),t=u.filter(".active"),t=r===40?t.next().add(u.eq(0)).eq(-1):t.prev().add(u.eq(-1)).eq(0),t.addClass("active").siblings().removeClass("active"))});this.$dropdown.on("click","[data-key]",function(){var t=n(this);i.val(t.attr("data-key"),t.text());t.addClass("active").siblings().removeClass("active");i.$dropdown.removeClass("show")});n(document).on("click",function(n){t.contains(i.element,n.target)||i.$dropdown.removeClass("show")})}}}t.register("input.input-search",i)})(jQuery,v2Kit);