/*!
 * JavaScript v2 v1.0.1
 * https://github.com/v2kit/v2
 *
 * @author hyly
 * @date 2018-08-01
 * @descript a valuable technology object.
 */
(function(n,t){function i(n){return'<span class="input-group-addon">'+(n||"")+"<\/span>"}function r(n){return t.isString(n)&&(n={text:n}),t.expression(t.format('<div class="input-group-btn"><button type="{return type || "button"^}" class="btn btn-{return style || "default"^}"{for(value<key> in [attributes]) "{key}="{value}""^}>{text}<\/button>{0}<\/div>',n.dropdown?'<ul class="dropdown-menu">{for(value<key> in [dropdown]) { if(key==="divider" && value === "divider"){ "<li role="separator" class="divider"><\/li>" } else { "<li data-val="{key}"><a href="javascript:void(0)">{value}<\/a><\/li>"} }^}<\/ul>':""),n)}function e(n){function r(){this.valid=!0;this.badInput=!1;this.patternMismatch=!1;this.rangeOverflow=!1;this.rangeUnderflow=!1;this.tooLong=!1;this.tooShort=!1;this.typeMismatch=!1;this.valueMissing=!1;this.customError=!1}var i;return r.prototype={isValid:function(r){var u=n.type;return r=r==null?n.value:r,r&&(u==="number"&&(t.jreg.number.test(r)?(this.rangeOverflow=~~r>n.max,this.rangeUnderflow=~~r<n.min):this.badInput=!0),u==="tel"&&(this.badInput=!t.jreg.tel.test(r)),u==="email"&&(this.typeMismatch=!t.jreg.mail.test(r)),u==="url"&&(this.typeMismatch=!t.jreg.url.test(r)),this.tooLong=r.length>n.maxlength,this.tooShort=r.length<n.minlength,(i=n.pattern)&&(i=f(i))&&(this.patternMismatch=!i.test(r))),this.valueMissing=n.required&&!r,this.valid=!(this.valueMissing||this.typeMismatch||this.badInput||this.patternMismatch||this.rangeOverflow||this.rangeUnderflow||this.tooLong||this.tooShort)},validError:function(){var i,r;if(this.customError)return n.ValidityError;if(this.valueMissing)return n.title?"请填写“"+n.title+"”字段。":"请填写此字段。";if(this.patternMismatch)return"请与所请求的格式保持一致。";if(this.badInput){if(n.type==="number")return"请输入一个数字。";if(n.type==="tel")return"请输入一个电话号码。"}if(n.type==="number"){if(this.rangeUnderflow)return t.format("值必须大于或等于{0}。",n.min);if(this.rangeOverflow)return t.format("值必须小于或等于{0}。",n.max)}return(i=n.value,this.typeMismatch&&n.type==="email")?(r=i.indexOf("@"),t.format(r>-1?"请在“@”内容"+(r>0?"后面":"前面")+"输入内容。{0}内容不完整。":"请在邮箱地址中包含“@”。{0}缺少“@”。",i)):this.tooShort?t.format("值必须大于或等于{0}个字符。",n.minlength):this.tooLong?t.format("值必须小于或等于{0}个字符。",n.maxlength):void 0}},new r}function o(n){function i(){}var t;return i.prototype={Massage:function(i){if(i=i||n.validity.validError(),i){var r=this;this.isReady||(this.$=this.$||n.$.prepend('<div class="input-validity"><div class="validity-status">!<\/div><span class="validity-massage"><\/span><\/div>').children().eq(0));this.$.find(".validity-massage").text(i);this.$.removeClass("hidden");t&&clearTimeout(t);t=setTimeout(function(){r.$.addClass("hidden");t=null},3e3);this.isReady=!0}},hide:function(){this.isReady&&(t&&clearTimeout(t),this.$.addClass("hidden"),t=null)}},new i}function s(f){return{ctor:function(){this.timelyValid=!1;this.min=-Infinity;this.max=Infinity;this.minlength=-1;this.maxlength=Infinity;this.multiple=!1;this.type="text";this.id="";this.name="";this.title="";this.value="";this.pattern="";this.required=!1;this.readonly=!1;this.placeholder="";this.validity=e(this);this.validityError=o(this)},init:function(){this.base.init();this.$=n(this.element);var i=this.type;(i==="date"||i==="time"||i==="datetime")&&(this.type="text");!this.placeholder&&this.title&&(this.placeholder="请输入"+this.title+"~");this.$.append(t.expression('<{return multiple ? "textarea" : "input"^}{if(id) " id="{id}""^} class="form-control"{if(type) " type="{type}""^}{if(name) " name="{name}""^} value="{value}"{if(type) " placeholder="{placeholder}""^}/>',this));this.$input=this.$.children().last();this.type=i},render:function(n){var u,f,e,o;this.base.render();this.readonly&&this.setReadonly(this.readonly);this.addClass("input-group");n.sm&&this.addClass("input-group-sm");n.lg&&this.addClass("input-group-lg");(n.labelsPre||n.labelsNext||n.buttonsPre||n.buttonsNext)&&(u=t.map(t.makeArray(n.labelsPre),i),f=t.map(t.makeArray(n.buttonsPre),r),this.$.prepend(f.join(""),u.join("")),e=t.map(t.makeArray(n.labelsNext),i),o=t.map(t.makeArray(n.buttonsNext),r),this.$.append(e.join(""),o.join("")))},setReadonly:function(n){this.$input.prop("readonly",!!n)},isValid:function(){return this.timelyValid?this.validity.valid:this.validity.isValid()},val:function(n,t){if(n==null)return this.isValid()?this.value:"";this.validity.isValid(n=n==null?"":n)?(this.$input.val(this.value=n),t&&f.invoke("valid-success")):(t&&f.invoke("valid-error",f.validity),this.validityError&&this.validityError.Massage())},setCustomValidity:function(n){(this.ValidityError=n&&typeof n=="string"&&n)&&(this.validity.customError=!0)},commit:function(){var n=this.type,i,o,r;if(n==="date"||n==="time"||n==="datetime"){window.laydate==null&&(window.laydate=!1,i=document.createElement("script"),i.defer=i.async=!0,i.src="/lib/laydate/laydate"+(t.debug?".min.js":".js"),document.body.appendChild(i));o=n==="date"?"yyyy-MM-dd":"yyyy-MM-dd HH:mm:ss";this.$input.on("click",function(){if(!window.laydate)return f.validityError.Massage("正在初始化日期控件！");laydate({keepYmd:n==="time",onchange:function(n){f.$input.val(f.value=n)},format:o,min:f.invoke("date-min"),max:f.invoke("date-max")})})}this.$input.on("click",function(){f.invoke("event-click")});this.$input.on("keydown",function(n){var r=this.value,i=n.keyCode||n.which;if(r.length===f.maxlength&&!(i===8||i===46))return!1;if(f.type==="number"){if(r=t.trim(r),i===107||i===109||i===187||i===189)return r=r.replace(/[+-]+/g,""),(i===109||i===189)&&(r="-"+r),this.value!==r&&(this.value=r),!1;if(i===102)return r=r&&r.replace(u,"")+".",this.value!==r&&(this.value=r),!1;if(i>=48&&i<=57||i>=96&&i<=105)return this.value=r+=Math.max(i-48,i-96),!1}if(f.invoke("keyboard-keyCode",i)===!1)return!1});r=!1;this.$input.on("compositionstart",function(){r=!0});this.$input.on("compositionend",function(){r=!1});var e,s=function(){var n=f.value=this.value;f.validity.isValid(n)?(f.invoke("valid-success"),f.validityError&&f.validityError.hide()):(f.invoke("valid-error",f.validity),f.validityError&&f.validityError.Massage());n!==f.value&&(this.value=f.value)},h=function(n){var t=n.value;(f.type==="number"&&(t=t.replace(/[^-+.0-9]/g,""),n.value!==t&&(n.value=t)),r||f.value===t)||(t=f.value=n.value,f.invoke("value-change",t),f.value!==t&&(t=n.value=f.value),f.timelyValid&&s.call(n,t),f.value!==t&&(n.value=f.value))},c=function(n){if(t.bro.isMsie||t.bro.isChrome||t.isFirefox&&t.isFirefox>=9)return h(n);e&&clearTimeout(e);e=setTimeout(function(){e=null;h(n)},50)};this.$input.on("keyup",function(n){var t=n.keyCode||n.which;(t===13||t===108)&&f.invoke("keyboard-enter");c(this)});this.$input.on("input propertychange",function(){c(this)});this.$input.on("blur",s)}}}var u=/(^\.+|\.+$)/g,f=t.makeCache(function(n){n[0]!="^"&&(n="^"+n);n[n.length-1]!="$"&&(n+="$");try{return new RegExp(n)}catch(t){}});t.register("input",s)})(jQuery,v2Kit);